<!--
* 
* @ Name    :   supplierDatatable
* @ Purpose :   The component allows users to select product, and a quote status respectively,helps to create quotes and quote lines and also displays information related to the uploaded file with the associated quote and helps to place an order.    
* @ Author  :   Manogna,Kumar Sai
*
*   Date            |  Developer Name                 |  Version      |  Changes
* ======================================================================================================
*   26-12-2022      |  manogna.koppula@absyz.com      |  1.0          |  Initial Version
*                      kumarsai.vadapalli@absyz.com
*
-->
<template>
  <lightning-card>
          <lightning-combobox
          name="Select Product Name"
          label="Select Product Name"
          value={Value}
          options={list_ProductNameFilter}
          onchange={handleProductChange}
          field-level-help="Select a Product"
          style="width:200px;"
          class="slds-align_absolute-center"></lightning-combobox>

          
        <template  if:true={blnIsShowQuoteStatus} >
          <lightning-combobox
          name="Select Quote Status"
          label="Select Quote Status"
          value={strQuoteStatusValue}
          options={QuoteStatusOptions}
          onchange={handleQuoteChange}
          field-level-help="Select the quote status"
          style="width:200px;"
          class="slds-align_absolute-center"></lightning-combobox>
        </template>

        <template  if:true={blnShowAccordion} >
          <lightning-accordion
          allow-multiple-sections-open
          active-section-name={strSection}
          onsectiontoggle={handleSectionToggle}>
          <template for:each={list_SupplierNameFilter} for:item="suppliername" for:index="index">
            <div class="slds-p-left_small" key={suppliername}>  
              <lightning-accordion-section name={suppliername} label={suppliername}>
                <div class="c-container">
                  <lightning-layout horizontal-align="spread">
                    <lightning-layout-item flexibility="auto" padding="around-small">
                      Product :<a onclick={NavigatetoProduct}  target="_blank">{strProductChange}</a>
                    </lightning-layout-item>
                  
                    <template  if:true={blnIsShowButtons} >
                      <lightning-layout-item flexibility="auto" padding="around-small">
                        <lightning-button variant="destructive" label="Reject" title="Destructive action" onclick={handlereject} class="slds-m-left_x-small" ></lightning-button>
                      </lightning-layout-item>
                      </template>
                  </lightning-layout>
                </div>
                <template if:true={blnIsShowQuoteLineItems}>
                  <lightning-card>
                    <div class="slds-box slds-theme_default">
                      <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered">
                        <thead>
                          <tr>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="Quote Number">Quote Number</div>
                            </th>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="Quote Line Number">Quote Line Number</div>
                            </th>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="List Price">List Price</div>
                            </th>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="Sales Price">Sales Price</div>
                            </th>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="Quantity">Quantity</div>
                            </th>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="Discount">Discount</div>
                            </th>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="Delivery Date">Delivery Date</div>
                            </th>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="Description">Description</div>
                            </th>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="Total Price">Total Price</div>
                            </th>
                            <template  if:true={blnIsShowButtons}>
                            <th class="" scope="col">
                              <div class="slds-truncate" title=""></div>
                            </th>
                            </template>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="">View Documents</div>
                            </th>
                            <template  if:true={blnIsShowButtons}>
                              <th class="" scope="col">
                                <div class="slds-truncate" title="Revise"></div>
                              </th>
                            </template>
                            <th class="" scope="col">
                              <div class="slds-truncate" title="">Finalised Price</div>
                            </th>
                            </tr>
                          </thead>
                          <tbody>
                            <template for:each={list_PFQuoteLineItems} for:item="PFQL">
                              <tr key={PFQL.Id}>
                                <td><a name={PFQL.Quote.Id} data-quotenavigation= {PFQL.Quote.Id} onclick={navigateToQuote} target="_blank">{PFQL.Quote.QuoteNumber}</a></td>
                                <td><a  name={PFQL.Id}  data-strquotelineid={PFQL.Id} onclick={Navigatetoquotelinenumber}  target="_blank">{PFQL.LineNumber}</a></td>
                                <td>{PFQL.ListPrice}</td>
                                <td><lightning-input type="text"  value={PFQL.UnitPrice} class="lgtinput slds-p-bottom_medium" disabled={PFQL.disabled} onchange={handlesalesprice}></lightning-input></td>
                                <td><lightning-input type="text" label="" value={PFQL.Quantity} class="lgtinput slds-p-bottom_medium" disabled={PFQL.disabled} onchange={handlequantity} ></lightning-input></td>
                                <td><lightning-input type="text" label="" value={PFQL.Discount} class="lgtinput slds-p-bottom_medium" disabled={PFQL.disabled} onchange={handlediscount} ></lightning-input></td>
                                <td><lightning-input type="date" label="" value={PFQL.Quote.PF_Estimated_Delivery_Date__c} class="lgtinput slds-p-bottom_medium" disabled={PFQL.disabled} onchange={handleDeliveryDate}></lightning-input></td>
                                <td><lightning-input type="text" label="" value={PFQL.Description} class="lgtinput slds-p-bottom_medium" disabled={PFQL.disabled} onchange={handledescription} ></lightning-input></td>
                                <td>{PFQL.TotalPrice}</td>
                                <template  if:true={blnIsShowButtons}>
                                <td><lightning-button variant="brand" label="Update"  data-qlid={PFQL.Id} data-revisecheck={PFQL.Quote.PF_Previous_Quote__c} disabled={PFQL.disabled} data-quantity={PFQL.Quantity} data-discount={PFQL.Discount} data-description={PFQL.Description} data-deliverydate={PFQL.Quote.PF_Estimated_Delivery_Date__c} data-salesprice={PFQL.UnitPrice}  onclick={handleupdate} data-qid={PFQL.QuoteId} class="slds-m-left_x-small"></lightning-button> </td>
                                </template>
                                <td> <lightning-icon icon-name="utility:preview" alternative-text="Preview" title="Preview" onclick={handlepdfids} data-qid={PFQL.QuoteId}></lightning-icon> </td>
                                <template  if:true={blnIsShowButtons}>
                                  <td><lightning-button variant="destructive-text" label="Revise" data-strquoteid={PFQL.Quote.Id} disabled={PFQL.disabled} data-revisecheck={PFQL.Quote.PF_Previous_Quote__c} data-qid={PFQL.QuoteId} onclick={handlerevise} class="slds-m-left_x-small"></lightning-button> </td>
                                </template>
                                <template  if:true={blnIsShowButtons}>
                                  <td><lightning-input type="checkbox" name='finalise' class="slds-p-left_xx-large" data-quoteid={PFQL.QuoteId} onchange={handleInputChange1} ></lightning-input> </td>
                                </template>
                                <template  if:true={blnShowFinalisedColumn}>
                                  <td>{PFQL.FinalisedValue}</td>
                                </template>
                              </tr>
                            </template>
                          </tbody>
                        </table>
                      </div>  
                    </lightning-card>
                  <template  if:true={blnIsShowButtons} >
                    <lightning-button variant="Brand" label="Place Order" title="Successful action" onclick={HandlePlaceOrder} class="slds-align_absolute-center" ></lightning-button>
                  </template>
                </template>
                </lightning-accordion-section>
              </div>
            </template>
          </lightning-accordion>
        </template>
      </lightning-card>  
      <template if:true={blnIsShowModal}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
          <div class="slds-modal__container">
            <header class="slds-modal__header">
              <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={hideModalBox}>
                <lightning-icon icon-name="utility:close"
                alternative-text="close"
                variant="inverse"
                size="small" ></lightning-icon>
                <span class="slds-assistive-text">Close</span>
              </button>
              <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Create Quote line items</h2>
            </header>           
            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
              <lightning-layout>
                <lightning-layout-item padding="around-small">
                  <p class="slds-p-around_small">Quote Number : <a  name={strStoreQuoteId}   onclick={RecordPage}  target="_blank"> {StrQuoteId}</a></p>
                  <p class="slds-p-around_small">Product : {strProductChange}</p>
                  <lightning-input type="text" name='Quantity' label="Enter Quantity"  class="slds-p-around_x-small" onchange={handleInputChange1}></lightning-input>
                  <lightning-input type="text" name='SalesPrice' label="Enter Sales Price" class="slds-p-around_x-small" onchange={handleInputChange1}></lightning-input>
                </lightning-layout-item>
                <lightning-layout-item padding="around-small">
                  <lightning-input type="text" name='Discount' label="Discount" class="slds-p-around_x-small slds-m-left_xx-large" onchange={handleInputChange1}></lightning-input>
                  <lightning-input type="text" name='Line Item Description' label="Line Item Description" class="slds-p-around_x-small slds-m-left_xx-large" onchange={handleInputChange1}></lightning-input>
                </lightning-layout-item>
              </lightning-layout>
            </div>           
            <footer class="slds-modal__footer">
              <lightning-button variant="Success" label="Create" title="Primary action" onclick={HandleCreateQLI} class="slds-m-left_x-small"></lightning-button>  </footer>
            </div>
          </section>
          <div class="slds-backdrop slds-backdrop_open"></div>
        </template>  
        <template if:true={blnIsShowPDFs}>
          <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
              <header class="slds-modal__header">
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={hideDocumentsPopUp}>
                  <lightning-icon icon-name="utility:close"
                  alternative-text="close"
                  variant="inverse"
                  size="small" onclick={closeModal}></lightning-icon>
                  <span class="slds-assistive-text">Close</span>
                </button>
                <h2 id="modal-heading-001" class="slds-text-heading_medium slds-hyphenate"></h2>
              </header>             
              <div style="height:25px;">
                <lightning-card title="Quote PDFs Preview">
                  <template if:true={blnShowMessage}>
                    <div class="slds-align_absolute-center" style="height:5rem">{message}</div>
                  </template>
                  <template for:each={list_Files} for:item="file">
                      <div key={file.value} class="slds-box">
                        <lightning-layout>
                          <lightning-layout-item size="4">
                            <p>{file.label}</p>
                         </lightning-layout-item>
                          <lightning-layout-item size="8">
                            <a href={strPDFRedirect} target="_blank"><lightning-button label="Preview"
                            variant="brand"
                           data-id={file.value}
                           onclick={previewHandler}
                           class="slds-float_right"
                            ></lightning-button> </a>
                        </lightning-layout-item>
                      </lightning-layout>
                      </div>
                  </template>
             </lightning-card>
              </div>             
              <footer class="slds-modal__footer">
                 </footer>
              </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
          </template>  
      </template>